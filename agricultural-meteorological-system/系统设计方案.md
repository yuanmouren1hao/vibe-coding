# 上海区域农业气象服务平台 - 系统设计方案

## 一、项目概述

### 1.1 项目背景
上海区域农业气象服务数据可视化平台是一个面向农业管理者的 Web 应用,旨在整合上海多个农场的实时气象数据,通过直观的可视化界面帮助用户监控区域气象状况,为农业生产决策提供数据支持。

### 1.2 核心定位
- **应用类型**: Web 数据可视化平台
- **目标用户**: 农业管理者、农场主、农技人员
- **核心价值**: 实时监控、数据对比、趋势分析、决策支持

## 二、技术架构

### 2.1 技术栈选型

#### 前端框架
- **Vue 3**: 使用 Composition API,代码组织更清晰
- **Vite**: 快速的开发构建工具,热更新体验优秀

#### UI 组件库
- **TDesign Vue Next**: 企业级设计系统,适合数据密集型应用
- 组件丰富: Table, Select, Button, Tag, Alert 等
- 设计规范: 符合专业数据看板的视觉需求

#### 数据可视化
- **Apache ECharts 5.5+**: 
  - 图表类型: 地图、折线图、雷达图、仪表盘
  - 交互能力: 缩放、悬停提示、图例切换
  - 地图支持: 使用 GeoJSON 渲染上海地图

#### 状态管理
- **Pinia**: Vue 3 官方推荐,API 简洁
- 集中管理气象数据、历史数据缓存

#### 路由管理
- **Vue Router 4**: 支持动态路由、嵌套路由
- 路由配置: 总览、对比、趋势、详情页

#### 工具库
- **Day.js**: 轻量级日期处理
- **Mock.js**: 前端数据模拟
- **Sass**: CSS 预处理器

### 2.2 架构设计

```
┌─────────────────────────────────────────────────┐
│                   Browser                        │
└─────────────────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────┐
│              Vue 3 Application                   │
│  ┌─────────────────────────────────────────┐   │
│  │         View Layer (Pages)              │   │
│  │  - Overview  - Compare                  │   │
│  │  - Trend     - FarmDetail               │   │
│  └─────────────────────────────────────────┘   │
│                     │                            │
│  ┌─────────────────────────────────────────┐   │
│  │      Component Layer                    │   │
│  │  - Charts  - Cards  - Tables            │   │
│  └─────────────────────────────────────────┘   │
│                     │                            │
│  ┌─────────────────────────────────────────┐   │
│  │      State Management (Pinia)           │   │
│  │  - WeatherStore (气象数据)              │   │
│  └─────────────────────────────────────────┘   │
│                     │                            │
│  ┌─────────────────────────────────────────┐   │
│  │         Mock Data Service               │   │
│  │  - generateMockData()                   │   │
│  │  - generateHistoryData()                │   │
│  └─────────────────────────────────────────┘   │
└─────────────────────────────────────────────────┘
```

### 2.3 数据流设计

```
[Mock 数据生成]
      ↓
[Pinia Store 存储]
      ↓
[Vue 组件消费] → [ECharts 渲染]
      ↓
[用户交互] → [数据更新] → [界面刷新]
```

## 三、功能模块设计

### 3.1 区域气象总览页

#### 功能描述
首页展示上海全区域的气象全局状况

#### 模块划分
1. **关键指标卡片区**
   - 4个横向卡片:区域平均温度、湿度、降雨量、风速
   - 动态颜色:根据数值范围变化背景色
   - 趋势标识:显示同比变化百分比

2. **地图可视化区**
   - 上海地图底图(GeoJSON)
   - 10个农场位置标记
   - 标记颜色分级:蓝色(低温) → 绿色(适温) → 橙红色(高温)
   - 悬停气泡:显示农场名称和核心气象数据
   - 点击跳转:跳转到农场详情页

3. **农场排行榜**
   - 表格展示:农场名称、温度、湿度、降雨量等
   - 排序功能:点击列标题排序
   - 极值高亮:标注最高/最低温度

4. **预警提示区**
   - 自动检测异常:温度>35°C 或 <5°C,降雨量>50mm
   - 预警级别:危险(红色)、警告(橙色)
   - 建议信息:提供应对建议

#### 技术实现
- **组件**: MetricCard, MapChart, FarmTable
- **ECharts 配置**: geo(地图) + scatter(散点)
- **数据计算**: computed 计算区域平均值

### 3.2 多农场对比页

#### 功能描述
支持2-4个农场的多维度对比分析

#### 模块划分
1. **农场选择器**
   - 多选下拉框(最多4个)
   - 区域快捷筛选:浦东、崇明、松江等
   - 已选农场展示:Tag 标签形式

2. **雷达图对比**
   - 6-8个气象指标
   - 不同农场使用不同颜色
   - 支持图例切换

3. **详细对比表格**
   - 表格行:各气象指标
   - 表格列:各农场数值
   - 单元格渐变色:根据数值高低

4. **时间序列对比**
   - 折线图展示7天数据
   - 支持切换指标:温度、湿度、降雨量
   - 多条折线代表不同农场

#### 技术实现
- **组件**: RadarChart, ComparisonTable, TimelineChart
- **ECharts 配置**: radar(雷达图) + line(折线图)
- **数据处理**: 历史数据按天聚合

### 3.3 历史趋势分析页

#### 功能描述
深度分析单个农场的历史气象数据

#### 模块划分
1. **参数配置区**
   - 农场选择:单选下拉框
   - 时间范围:7天/30天
   - 分析指标:多选复选框

2. **多指标趋势图**
   - 大型折线图,支持多Y轴
   - 区域缩放:拖拽选择时间段放大
   - 数据点悬停显示

3. **数据统计卡片**
   - 平均值、最大值、最小值
   - 标准差、变化趋势
   - 4个卡片对应不同指标

4. **数据导出区**
   - 导出CSV:原始数据
   - 保存图片:图表截图
   - 生成PDF:分析报告

#### 技术实现
- **组件**: MultiMetricTrend, StatCard
- **ECharts 配置**: dataZoom(缩放) + 多Y轴
- **统计计算**: 方差、标准差算法

### 3.4 农场详情页

#### 功能描述
展示单个农场的全面气象信息

#### 模块划分
1. **农场信息卡片**
   - 名称、位置、面积、主要作物
   - 面包屑导航

2. **实时气象仪表盘**
   - 8个仪表盘:温度、湿度、风速、降雨量、气压、光照、土壤温度、土壤湿度
   - 圆形仪表盘设计
   - 动态颜色指示

3. **24小时预测曲线**
   - 双Y轴折线图:温度+湿度
   - 渐变色填充区域
   - 标注当前时间点

4. **适种建议区**
   - 根据气象条件推荐作物
   - 适宜度评分:95%、88%等
   - 推荐理由说明

5. **历史数据快速查看**
   - 迷你折线图:过去7天趋势
   - 点击跳转到趋势分析页

#### 技术实现
- **组件**: GaugeCard, ForecastChart, CropSuggestions
- **ECharts 配置**: gauge(仪表盘) + line(折线图)
- **算法**: 作物适种规则引擎

## 四、数据方案设计

### 4.1 Mock 数据结构

#### 农场配置
```javascript
{
  id: 'farm1',
  name: '浦东新区绿谷农场',
  region: '浦东新区',
  area: 280,
  crops: ['水稻', '蔬菜'],
  location: [121.6, 31.2]
}
```

#### 实时气象数据
```javascript
{
  temperature: 24.5,      // 温度 °C
  humidity: 68.2,         // 湿度 %
  rainfall: 3.5,          // 降雨量 mm
  windSpeed: 4.2,         // 风速 m/s
  windDirection: '东南',   // 风向
  pressure: 1015.3,       // 气压 hPa
  lightIntensity: 5200,   // 光照强度 lux
  soilTemp: 22.8,         // 土壤温度 °C
  soilMoisture: 62.5      // 土壤湿度 %
}
```

#### 历史数据
```javascript
{
  time: '2024-01-15 14:00',
  timestamp: 1705305600000,
  temperature: 24.5,
  humidity: 68.2,
  rainfall: 0.2,
  windSpeed: 4.1,
  pressure: 1015.2,
  lightIntensity: 6800
}
```

### 4.2 数据生成策略

1. **随机数范围控制**
   - 温度: 基准温度 ± 浮动范围
   - 湿度: 45% - 85%
   - 降雨量: 0 - 15mm
   - 风速: 1 - 8 m/s

2. **时间规律模拟**
   - 温度日变化:白天升温,夜间降温
   - 光照强度:6:00-18:00 有值,其他时间为0
   - 降雨量:白天概率较高

3. **地域差异**
   - 崇明区:温度略低,湿度偏高
   - 浦东区:温度适中
   - 金山区:降雨量偏多

### 4.3 数据更新机制

- **实时数据**: 点击"刷新数据"按钮手动更新
- **自动刷新**: 可扩展定时器自动刷新(每30秒)
- **历史数据**: 缓存策略,避免重复生成

## 五、UI/UX 设计

### 5.1 设计风格

#### 色彩系统
- **主色调**: 深蓝色 #1E3A8A (科技、专业)
- **辅助色**: 青绿色 #10B981 (农业、生机)
- **强调色**: 琥珀色 #F59E0B (预警、高亮)
- **背景色**: 浅灰白 #F9FAFB
- **卡片背景**: 白色 #FFFFFF

#### 字体排版
- **主字体**: Noto Sans SC / Microsoft YaHei
- **数据字体**: Courier New (等宽字体)
- **标题**: 20-24px,加粗
- **正文**: 14px,常规
- **数据**: 28-32px,加粗

### 5.2 布局设计

#### 整体布局
```
┌─────────────────────────────────────────────┐
│  Sidebar (240px)  │  Main Content          │
│  ┌─────────────┐  │  ┌──────────────────┐  │
│  │    Logo     │  │  │  Header (64px)   │  │
│  ├─────────────┤  │  ├──────────────────┤  │
│  │    Menu     │  │  │                  │  │
│  │  - 总览     │  │  │   Page Content   │  │
│  │  - 对比     │  │  │                  │  │
│  │  - 趋势     │  │  │                  │  │
│  ├─────────────┤  │  └──────────────────┘  │
│  │   Footer    │  │                         │
│  └─────────────┘  │                         │
└─────────────────────────────────────────────┘
```

#### 响应式断点
- **1920x1080**: 完整4列网格
- **1366x768**: 2列网格,部分组件堆叠

### 5.3 交互设计

#### 动画效果
- **页面切换**: 300ms 淡入淡出
- **卡片加载**: 从下向上滑入
- **数值变化**: 数字滚动动画
- **图表绘制**: 渐进式动画(从左到右)

#### 交互反馈
- **悬停效果**: 卡片阴影加深,轻微上浮
- **点击反馈**: 按钮按下效果
- **加载状态**: 骨架屏占位

## 六、性能优化

### 6.1 前端优化
- **路由懒加载**: 所有页面使用动态 import
- **组件按需引入**: TDesign 组件按需加载
- **ECharts 实例管理**: 组件销毁时 dispose
- **防抖节流**: resize 事件使用节流

### 6.2 数据优化
- **历史数据缓存**: Pinia store 缓存已查询的数据
- **按需生成**: 只在需要时生成历史数据
- **数据压缩**: 历史数据按天聚合显示

## 七、扩展性设计

### 7.1 功能扩展
- **实时推送**: 可接入 WebSocket 实现数据实时推送
- **用户权限**: 可添加登录、权限管理
- **多语言**: 使用 vue-i18n 支持国际化
- **主题切换**: 扩展深色模式

### 7.2 数据扩展
- **真实 API**: 替换 Mock 数据为真实后端 API
- **数据库集成**: 连接时序数据库(InfluxDB)
- **大数据量**: 虚拟滚动、分页加载

## 八、部署方案

### 8.1 开发环境
```bash
npm run dev  # 本地开发,端口 5173
```

### 8.2 生产构建
```bash
npm run build  # 生成 dist 目录
```

### 8.3 部署选项
1. **静态托管**: Vercel, Netlify, GitHub Pages
2. **CDN 加速**: 阿里云 OSS + CDN
3. **Docker 容器**: Nginx + Vue SPA
4. **服务器**: Apache / Nginx 配置

## 九、测试策略

### 9.1 功能测试
- 页面跳转是否正常
- 图表数据是否正确渲染
- 交互操作是否符合预期

### 9.2 性能测试
- 页面加载时间 < 2s
- 图表渲染流畅度
- 内存占用是否合理

### 9.3 兼容性测试
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

## 十、项目总结

### 10.1 技术亮点
✅ Vue 3 Composition API 最佳实践
✅ ECharts 复杂图表应用(地图、雷达图、仪表盘)
✅ Pinia 状态管理实战
✅ TDesign 企业级组件库应用
✅ 响应式设计与动画效果

### 10.2 功能完整性
✅ 4个核心页面全部实现
✅ 15+ 可复用组件
✅ 完整的 Mock 数据服务
✅ 丰富的数据可视化

### 10.3 代码质量
✅ 模块化设计,职责清晰
✅ 组件复用性高
✅ 代码注释完整
✅ 目录结构规范

---

**文档版本**: v1.0
**最后更新**: 2024年
**作者**: AI 智能编程助手
